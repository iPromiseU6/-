<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<form id="ff">
    <div>
        <table id="basicData" class="displaytable" style="text-align: left;">
            <tr>
                <td width="10%">CustomerName:</td>
                <td width="35%">
                    <input type="text" style="width: 80%" class="easyui-textbox" id="input_customerName"/>
                </td>
                <td width="10%">Phone No:</td>
                <td width="35%">
                    <input type="text" style="width: 80%" class="easyui-textbox" id="input_phoneNumber"/>
                </td>
            </tr>
            <tr>
                <td width="10%">Customer No:</td>
                <td width="35%">
                    <input type="text" style="width: 80%" class="easyui-textbox" id="input_customerNumber"/>
                </td>
                <td width="10%">CustomerID:</td>
                <td width="35%">
                    <input type="text" style="width: 80%" class="easyui-textbox" id="input_customerId"/>
                </td>
            </tr>
        </table>
        <span id="alert" style="width: 80%;height: 20px;"></span>
        <div class="submit_button">
            <a class="easyui-linkbutton" iconCls="icon-reload" onclick="cancel()" style="width: 100px;">Cancel</a>
            <a class="easyui-linkbutton" iconCls="icon-save" onclick="doSearch()" style="width: 100px;">Search</a>
        </div>
        <table id="dg">
        </table>
    </div>
</form>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/BasicPreview.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="../../JS/Header.js"></script>
<script type="text/javascript">
    var gApiKey = 'CUSTOMERS';
    var gRequest = new RequestHandle();
    var gBasicList = new BasicListPage();
    var gCustomerNumber;
    var gConfig = {
        fitColumns: 'true',
        rownumbers: 'true',
        singleSelect: true,
        width: '100%',
        height: 190,
        striped: 'true',
        loadMsg: '正在吃力加载中.....',
        showFooter: 'true',
        columns: [
            [{
                field: 'id',
                title: 'id',
                width: '0%',
                align: 'center'
            }, {
                field: 'firstName',
                title: 'FirstName',
                width: '24%',
                align: 'center',
            },{
                field: 'lastName',
                title: 'LastName',
                width: '24%',
                align: 'center',
            }, {
                field: 'nationality1',
                title: 'Nationality',
                width: '24%',
                align: 'center',
                formatter: function (v) {
                    return JSON.parse(localStorage.getItem("CountryCodes")).filter(function (current) {
                        return current.code == v;
                    })[0].name;
                }
            }, {
                field: 'phoneNumber',
                title: 'Phone no',
                width: '24%',
                align: 'center',
            }]
        ],
        onDblClickRow: function (index, row) {
            var id = getMultiID().id;
            var pLocation = "UI/Transaction/ReceiptDetail.html?id=" + gCustomerNumber;
            AddTabIn("ReceiptDetail", parent.$('#tabs'), pLocation);
            var _parentLocation = searchParent("Receipt.html");
            _parentLocation.dialogClose();
        },
    };

    gBasicList.createDataGrid(gConfig);

    function doSearch() {
        var _data = submitFormData();
        var _sendData = {};
        for (var name in _data) {
            if (!_data[name])
                continue;
            _sendData[name] = _data[name];
        }
        _sendData = JSON.stringify(_sendData);
        gRequest.postRemoteData(gApiKey, 'allbrif', _sendData).done(function (_result) {
            if (_result.code == 0) {
                if (_result.data.length === 0) {
                    $("#alert").text('do not find customer ,please check you information, or add a new customer you want');
                    return;
                }
                gCustomerNumber = _result.data[0].customerNumber;
                gBasicList.createDataGrid(gConfig);
                gBasicList.hideColumn(['id']);
                $("#dg").datagrid('loadData', _result.data);
            } else {
                $.messager("Alert", _result.msg);
            }
        });
    }

    function cancel() {
        $("#input_customerName").textbox('setValue', "");
        $("#input_phoneNumber").textbox('setValue', "");
        $("#input_customerNumber").textbox('setValue', "");
        $("#input_customerId").textbox('setValue', "");
        $("#dg").datagrid('loadData', {total: 0, rows: []});
    }
</script>
</body>
</html>
