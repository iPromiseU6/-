<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<form id="ff">
    <div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>Payment:</span>
            <input type="text" class="easyui-textbox" id="input_payment"
                   style="width: 65%"/>
        </div>
        <div id="div_account">
            <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
                <span style='margin-right: 5px' id="span_accountName">account:</span>
                <input type="text" class="easyui-textbox" id="input_accountId"
                       style="width: 65%"/>
            </div>
        </div>

        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>Amount:</span>
            <input type="text" class="easyui-textbox" id="input_foreignAmount"
                   style="width: 65%"/>
        </div>

    </div>
    <div class="submit_button">
        <a class="easyui-linkbutton" iconCls="icon-save" onclick="saveRowData()" style="width: 100px;">Save</a>
        <a class="easyui-linkbutton" iconCls="icon-reload" onclick="cancel()" style="width: 100px;">Cancel</a>
    </div>
</form>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/BasicPreview.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="../../JS/Header.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicDetail.js"></script>
<script type="text/javascript" src="../../JS/jquery.edatagrid.js"></script>
<script type="text/javascript" src="./ReceiptDetailCommon.js"></script>
<script type="text/javascript">

    var gAPiKey = "DEAL";
    var gRowId = getMultiID().rowIndex;
    var gGridId = getMultiID().gridId;
    var gRequestHandle = new RequestHandle();
    var myConvertData = {};
    var gOriginData = {};

    init();
    $(function () {
        if (gRowId == -1) {
            setAccountType({});
            clearFormData();
        } else {
            var parentLocation = searchParent("ReceiptDetail.html");
            var currentRow = deepCopy(parentLocation.getRow(gGridId));
            gOriginData = deepCopy(currentRow);
            currentRow = setAccountType({text: currentRow.payment}, currentRow);
            getFormData(currentRow);
        }
    });

    function init() {
        createComponentFactory("TRANSACTION_PAYMENTTYPE", '#input_payment', gComboboxConfig);
        createComponentFactory("TRANSACTION_ACCOUNT", "#input_accountId", gComponyAccountConfig);
        bundleEvent();
    }

    function cancel() {
        clearFormData();
        var parentLocation;
        parentLocation = searchParent("ReceiptDetail.html");
        parentLocation.AddDialog.dialog('close');
    }

    function saveRowData() {
        var formData = submitFormData();
        var parentLocation = searchParent("ReceiptDetail.html");
        Object.keys(formData).forEach(function (filed) {
            if (gConvertFieldData[filed]) {
                formData[filed] = typeof formData[filed] === 'number' ? formData[filed] : window['parse' + gConvertFieldData[filed]](formData[filed]);
            }
        });
        formData = mergeUpdateData(gOriginData, formData);
        parentLocation.reloadGridData(gGridId, formData, gRowId, gOriginData.id);
        cancel();
    }

    function bundleEvent() {
        $("#input_payment").combobox({
            onSelect: function (e) {
                return setAccountType(e);
            }
        });
        $("#input_accountId").combobox({
            onShowPanel: function () {
                var _data = [];
                if (gGridId === '#toClientDlg') {
                    _data = JSON.parse(localStorage.getItem('currentAccount'));
                    $(this).combobox("loadData", _data || []);
                } else if (gGridId === '#fromClientDlg') {
                    _data = JSON.parse(localStorage.getItem('companyAccount')).filter(function (current) {
                        current.accountName = current.name;
                        return true;//filter条件根据货币类型来筛选，如果没有选择则有问题
                    });
                    $(this).combobox("loadData", _data || []);
                }
            }
        });
    }

    function setAccountType(e, row) {
        switch (e.text) {
            case "T/T":
                if (gGridId === '#toClientDlg') {
                    $("#span_accountName").html("CustomerAccount");
                } else if (gGridId === '#fromClientDlg') {
                    $("#span_accountName").html("CompanyAccount");
                }
                $("#div_account").css("display", "block");
                break;
            default:
                $("#div_account").css("display", "none");
                break;
        }
        return row;
    }


</script>
</html>
