<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/BasicDataPreview.css">
</head>
<body style="overflow-x:hidden">
<div id="div_displayStatus" style="display: flex;justify-content:flex-end;margin-right: 2%;margin-bottom: 1%">
    <div id="toolbar1" style="margin-bottom: 10px;padding:10px;width:100px;margin-right: 80%">
    </div>
    <span id="span_status" class="span_status"></span>
</div>
<div id="p" class="easyui-panel" title="CustomerInfo"
     style="width:98%;height:120px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,minimizable:false,maximizable:false,selected:true,collapsible:true,collapsed:true">
    <div id="div_content" style="width: 80%;height:100px"></div>
</div>
<div id="edit" class="easyui-panel" title="IdentityInfo"
     style="width:98%;height:250px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',
    collapsible:true,collapsed:true,minimizable:false,maximizable:false,tools:'#indentityInfoEdit',loadingMessage : '加载中...'">
    <div id="indentityInfoEdit">
        <a class="icon-edit" id="identityInfoButton" onclick="editIndentityInfo()"></a>
    </div>
    <table id='table_identity' style="height: auto;"></table>
</div>
<div class="easyui-panel" title="Address"
     style="width:98%;height:250px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,
    collapsible:true,collapsed:true,minimizable:false,maximizable:false,tools:'#addressInfoEdit',selected:false">
    <div id="addressInfoEdit">
        <a class="icon-edit" id="addressInfoButton" onclick="editAddressInfo()"></a>
    </div>
    <table id='table_address' style="height: auto;"></table>
</div>
<div id="TransactionInfo" class="easyui-panel" title="TransactionInfo"
     style="width:98%;height:250px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,minimizable:false,maximizable:false,selected:false,collapsible:true,collapsed:true">
    <form id="ff_transactionInfo" style="width: 100%">
        <table class="displayable" style="text-align:right;width: 100%">
            <tr style="height: 60px;width: 100%">
                <td style="width: 8%;">TransactionNumber:</td>
                <td style="width: 25%;text-align: left;">
                    <input type="text" class="easyui-textbox" style="width: 80%;" disabled='disabled'
                           id="input_transactionNumber"/>
                </td>
                <td style="width: 8%"><span class="required">*</span>TransactionDate:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-datebox" id="input_dateTransaction" style="width: 80%;"
                           data-options="required:true"/>
                </td>
                <td style="width: 8%"><span class="required">*</span>Visible</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-combobox" id="input_visible" style="width: 80%;"
                           data-options="required:true,value:'1'"/>
                </td>
            </tr>
            <tr style="height: 60px;width: 100%">
                <td style="width: 8%;">TransmodeCode:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-combobox" style="width: 80%;"
                           id="input_transmodeCode"/>
                </td>
                <td style="width: 8%;"><span class="required">*</span>LocalRate:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-numberbox" id="input_localRate" style="width: 80%;"
                           data-options="required:true"/>
                </td>
                <td><span class="required">*</span>AmountLocal:</td>
                <td style="width: 25%">
                    <div style="display: flex">
                        <input type="text" class="easyui-numberbox" id="input_amountLocal" style="width: 82%"/>
                        <a class="easyui-linkbutton"
                           style="width: 20%;margin-left:2%;color: #fff;background-color: #0088ec"
                           onclick="calculate()">calculate</a>
                    </div>
                </td>
            </tr>
        </table>
        <div style="margin-bottom: 20px">
            <p style="display: inline-block;margin-left: 1px">transactionDescription:</p>
            <input type="text" class="easyui-textbox" id="input_transactionDescription"
                   style="width: 86%"/>
        </div>
    </form>
    <div id="div_content3" style="width: 80%;height:120px;display: none;"></div>
</div>
<div id="fromClient" class="easyui-panel" title="FromClient"
     style="width:98%;height:550px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,
    collapsible:true,minimizable:false,maximizable:false,collapsed:true">
    <form id="ff_formClient" style="width: 100%">
        <table class="displayable" style="text-align:right;width: 100%">
            <tr style="height: 60px;width: 100%">
                <td style="width: 8%;"><span class="required">*</span>FromCurrencyCode:</td>
                <td style="width: 25%;text-align: left;">
                    <input type="text" class="easyui-textbox" style="width: 80%;"
                           id="input_fromCurrencyCode" data-options="required:true"/>
                </td>
                <td style="width: 8%"><span class="required">*</span>FromAmount:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-numberbox" id="input_fromAmount" style="width: 80%;"
                           data-options="required:true,precision:2"/>
                </td>
            </tr>
            <tr style="height: 60px">
                <td><span class="required">*</span>ExchangeRate:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-textbox" id="input_exchangeRate" style="width: 80%;"
                           data-options="required:true"/>
                </td>
                <td style="width:25%;text-align: left">
                    <a class="easyui-linkbutton"
                       style="width:40px;background-color: #0088ec;display: inline-block;color: #fff"
                       onclick="mult()">×</a>
                    <a class="easyui-linkbutton"
                       style="width:40px;background-color: #0088ec;display: inline-block;color: #fff"
                       onclick="division()">÷</a>
                    <a class="easyui-linkbutton"
                       style="width: 60px;background-color: #0088ec;display: inline-block;color: #fff"
                       onclick="checkCombobox()">Check</a>
                </td>
            </tr>
        </table>
        <div style="margin-bottom: 20px">
            <p style="display: inline-block;margin-left: 75px">Comments:</p>
            <input type="text" class="easyui-textbox" id="input_fromFundsComment" style="width:84%"/>
        </div>
        <div class="easyui-panel" title="Data" style="width:100%;height:255px;overflow-x:hidden">
            <div id="fromClientToolBar">
                <a class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:'false'"
                   onclick="newData('#fromClientDlg')" style="width: 70px">Create</a>
                <a class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:'false'"
                   onclick="destroy('#fromClientDlg')" style="width: 70px">remove</a>
            </div>
            <table id="fromClientDlg"
                   style="height: auto;"></table>
        </div>
    </form>
</div>
<div id="toClient" class="easyui-panel" title="toClient"
     style="width:98%;height:500px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,
    collapsible:true,minimizable:false,maximizable:false,collapsed:true">
    <form id="ff_toClient" style="width: 100%">
        <table class="displayable" style="text-align:right;width: 100%;margin-bottom: 5px">
            <tr style="height: 60px;width: 100%;">
                <td style="width: 8%;"><span class="required">*</span>ToCurrencyCode:</td>
                <td style="width: 25%;text-align: left;">
                    <input type="text" class="easyui-combobox" style="width: 80%;"
                           id="input_toCurrencyCode" data-options="required:true"/>
                </td>
                <td style="width: 8%"><span class="required">*</span>toAmount:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-numberbox" id="input_toAmount" style="width: 80%;"
                           data-options="required:true,precision:2"/>
                </td>
            </tr>
        </table>
        <div style="margin-bottom: 20px">
            <p style="display: inline-block;margin-left: 75px">Comments:</p>
            <input type="text" class="easyui-textbox" id="input_toFundsComment" style="width:84%"/>
        </div>
        <div class="easyui-panel" title="Data" style="width:100%;height:255px;overflow-x:hidden">
            <div id="toClientToolBar">
                <a class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:'false'"
                   onclick="newData('#toClientDlg')" style="width: 70px">Create</a>
                <a class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:'false'"
                   onclick="destroy('#toClientDlg')" style="width: 70px">remove</a>
            </div>
            <table id="toClientDlg"
                   style="height: auto;"></table>
        </div>
    </form>
</div>
<div id="Arrives" class="easyui-panel" title="Arrives"
     style="width:98%;height:255px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,minimizable:false,maximizable:false,collapsible:true">
    <form id="ff_arrives" style="width: 100%">
        <div id="arrivesToolBar">
            <a class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:'false'"
               onclick="newData('#arrivesTable')" style="width: 70px">Create</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:'false'"
               onclick="confirm('#arrivesTable')" style="width: 80px">Confirm</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:'false'"
               onclick="deleteItem('#arrivesTable')" style="width: 70px">Delete</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:'false'"
               onclick="thirdTransaction()" style="width: 170px">Third Transaction</a>
        </div>
        <table id="arrivesTable"
               style="height: auto;"></table>
    </form>
</div>
<div id="Pays" class="easyui-panel" title="Pays"
     style="width:98%;height:255px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,minimizable:false,maximizable:false,collapsible:true">
    <form id="ff_pays" style="width: 100%">
        <div id="paysToolBar">
            <a class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:'false'"
               onclick="newData('#paysTable')" style="width: 70px">Create</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-save',plain:'false'"
               onclick="confirm('#paysTable')" style="width: 80px">Confirm</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:'false'"
               onclick="deleteItem('#paysTable')" style="width: 70px">Delete</a>
        </div>
        <table id="paysTable"
               style="height: auto;"></table>
    </form>
</div>
<div id="serviceFree" class="easyui-panel" title="Service Fee"
     style="width:98%;height:120px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,minimizable:false,maximizable:false,collapsible:true,collapsed:true">
    <form id="ff_serviceFree" style="width: 100%">
        <table class="displayable" style="text-align:right;width: 100%">
            <tr style="height: 60px;width: 100%">
                <td style="width: 8%"><span class="required">*</span>CompanyAccount:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-combobox" id="input_companyAccountId" style="width: 80%;"
                           data-options="required:true"/>
                </td>
                <td style="width: 8%;"><span class="required">*</span>PaymentType:</td>
                <td style="width: 25%;text-align: left;">
                    <input type="text" class="easyui-combobox" style="width: 80%;"
                           id="input_payment" data-options="required:true"/>
                </td>
                <td style="width: 8%"><span class="required">*</span>ServiceAmount:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-numberbox" id="input_amount" style="width: 80%;"
                           data-options="required:true"/>
                </td>
            </tr>
        </table>
    </form>
</div>
<div id="dlg" class="easyui-dialog" closed="true">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/BasicPreview.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="../../JS/Header.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicDetail.js"></script>
<script type="text/javascript" src="../../JS/jquery.edatagrid.js"></script>
<script type="text/javascript" src="./ReceiptDetailCommon.js"></script>
<script type="text/javascript">
    var gRequest = new RequestHandle();
    var gUpdateData = {};
    var gDealKey = "DEAL";
    var gCustomersKey = "CUSTOMERS";
    var gCurrid = getID();
    var gRateStatus = RateStatus.neither;

    init();

    $(function () {
        forbidForm();
        var _sendData = {customerNumber: gCurrid};
        if (gCurrid[0] == "C") {
            _sendData = JSON.stringify(_sendData);
            $('#input_dateTransaction').datebox('setValue', initDate(new Date()));//新增的话默认日期为当天
            gRequest.postRemoteData(gCustomersKey, "allbrif", _sendData).done(function (_result) {
                getPersonBasicInfo(_result);
            });
            gRequest.putRemoteData(gDealKey, "getnum").done(function (_result) {
                $("#input_transactionNumber").textbox('setValue', _result.data);
            });
        } else {
            var _customerNumber;
            _sendData = {id: gCurrid};
            gRequest.putRemoteData(gDealKey, "get", _sendData).done(function (_result) {
                if (_result.code === 0) {
                    gUpdateData = deepCopy(_result.data);
                    sessionStorage.setItem('currentReceipt', JSON.stringify(gUpdateData));//Receipt信息存浏览器内存
                    _result.data = convertDateData(_result.data, "/");
                    _result.data = convertFormData(_result.data, gConvertData);
                    getFormData(_result.data, true, gFormList);
                    setServiceFee(_result.data.serviceFee);
                    loadGridData(_result);
                    _customerNumber = _result.data.customerNumber;
                    _sendData = {customerNumber: _customerNumber};
                    _sendData = JSON.stringify(_sendData);
                    gRequest.postRemoteData(gCustomersKey, "allbrif", _sendData).done(function (_result) {
                        getPersonBasicInfo(_result);
                    });
                    setStatus(_result.data);
                }
            });
        }
    });

    function init() {
        //设置combobox
        createComponentFactory("RECEIPT_VISIBLE", '#input_visible', gComboboxConfig);
        createComponentFactory("RECEIPT_TRANSMODECODE", '#input_transmodeCode', gComboboxConfig);
        createComponentFactory("BASICDATA_CURRENCIES", '#input_fromCurrencyCode', gComboboxConfig);
        createComponentFactory("BASICDATA_CURRENCIES", '#input_toCurrencyCode', gComboboxConfig);
        createComponentFactory("RECEIPT_PAYMENTTYPE", '#input_payment', gComboboxConfig);
        createDataGrid(extendConfig(gConfig, "#fromClientDlg", 'fromClients'), "#fromClientDlg", '#fromClientToolBar');
        $('#fromClientDlg').edatagrid('hideColumn', 'id');
        createDataGrid(extendConfig(gConfig, "#toClientDlg", 'toClients'), "#toClientDlg", '#toClientToolBar');
        $('#toClientDlg').edatagrid('hideColumn', 'id');
        createDataGrid(extendConfig(gAdminConfig, "#arrivesTable", "arrives"), "#arrivesTable", '#arrivesToolBar');
        $('#arrivesTable').edatagrid('hideColumn', 'id');
        createDataGrid(extendConfig(gAdminConfig, "#paysTable", "pays"), "#paysTable", '#paysToolBar');
        $('#paysTable').edatagrid('hideColumn', 'id');
        createDataGrid(gIdentityConfig, "#table_identity");
        createDataGrid(gAddressConfig, "#table_address");
        addToolTips();
    }

    function getPersonBasicInfo(result) {
        localStorage.setItem("customerInfo", JSON.stringify(result.data[0]));
        createPreview(gConfigCustomerInfo, "#div_content", "local", "customerInfo");
        gUpdateData.personId = result.data[0].personId;
        gUpdateData.phoneNumber = result.data[0].phoneNumber;
        gUpdateData.customerAccountType = result.data[0].customerAccountType;
        var _sendData = {id: result.data[0].personId, type: "customerIdent"};
        gRequest.putRemoteData(gCustomersKey, "ident/list", _sendData).done(function (_result) {
            localStorage.setItem("customerIdent", JSON.stringify(_result.data[0]));
            var _obj = {"total": _result.data.length, "rows": _result.data};
            $('#table_identity').datagrid('loadData', _obj);
            // createPreview(gConfigIdentityInfo, "#div_content1", "local", "customerIdent");
        });
        _sendData = {id: result.data[0].personId, type: "customerAddress"};
        gRequest.putRemoteData(gCustomersKey, "addr/list", _sendData).done(function (_result) {
            localStorage.setItem("customerAddress", JSON.stringify(_result.data[0]));
            var _obj = {"total": _result.data.length, "rows": _result.data};
            $('#table_address').datagrid('loadData', _obj);
        });
        getCustomerInfo(result);
    }

    function getCustomerInfo(result) {
        //用customerId去拿accountId
        gUpdateData.customerId = result.data[0].id.toString();
        gRequest.putRemoteData(gAccountKey, "list", {id: result.data[0].id.toString()}).done(function (_result) {
            gUpdateData.accountId = _result.data[0].id;
            localStorage.setItem('currentAccount', JSON.stringify(_result.data));
        });
        gRequest.putRemoteData(gEntityKey, "list", {id: result.data[0].id.toString()}).done(function (_result) {
            localStorage.setItem('currentEntity', JSON.stringify(_result.data));
        });
    }

    function loadGridData(result) {
        var _sendData = {id: gCurrid};
        var loadData = function (_result) {
            //展示FromClient表格数据
            sessionStorage.setItem('currentReceipt', JSON.stringify(_result.data));//Receipt信息存浏览器内存

            changeValueToText(_result.data.fromClients, gConvertGridData.fromClients);
            var _obj = {"total": _result.data.fromClients.length, "rows": _result.data.fromClients};
            $('#fromClientDlg').datagrid('loadData', _obj);
            //展示toClient表格数据
            changeValueToText(_result.data.toClients, gConvertGridData.toClients);
            _obj = {"total": _result.data.toClients.length, "rows": _result.data.toClients};
            $('#toClientDlg').datagrid('loadData', _obj);
            //arrives表格展示
            changeValueToText(_result.data.arrives, gConvertGridData.arrives);
            _obj = {"total": _result.data.arrives.length, "rows": _result.data.arrives};
            $("#arrivesTable").datagrid('loadData', _obj);
            //pays表格数据展示
            changeValueToText(_result.data.pays, gConvertGridData.pays);
            _obj = {"total": _result.data.pays.length, "rows": _result.data.pays};
            $("#paysTable").datagrid('loadData', _obj);
        };
        if (result) {
            loadData(result);
        } else {
            gRequest.putRemoteData(gDealKey, "get", _sendData).done(function (_result) {
                loadData(_result);
            });
        }
    }

    function bundleEvent() {
        $("#input_fromCurrencyCode").combobox({
            onSelect: function (record) {
                if (record.code === 'NZD') {
                    gRateStatus = RateStatus.NZDIsFrom;
                    RateStatus[gRateStatus]($("#input_fromAmount").textbox('getValue'));
                    return;
                }
                gRateStatus = RateStatus.neither;
            }
        });
        $("#input_toCurrencyCode").combobox({
            onSelect: function (record) {
                if (record.code === 'NZD') {
                    gRateStatus = RateStatus.NZDisTo;
                    RateStatus[gRateStatus]($("#input_toAmount").textbox('getValue'));
                    return;
                }
                gRateStatus = RateStatus.neither;
            }
        });
        $("#input_localRate").numberbox({
            onChange: function (newValue, oldValue) {
                var value = $("#input_localRate").numberbox('getValue') * $("#input_fromAmount").textbox('getValue');
                RateStatus[gRateStatus](value);
            }
        });
    }

    function forbidForm() {
        gFormList.forEach(function (current) {
            forbidFormData(current, true);
        });
    }

    function saveTransaction() {
        gFormList.forEach(function (current) {
            var currentFormData = submitFormData(current);
            Object.keys(currentFormData).forEach(function (filed) {
                if (gConvertFieldData[filed]) {
                    currentFormData[filed] = typeof currentFormData[filed] === 'number' ? currentFormData[filed] : window['parse' + gConvertFieldData[filed]](currentFormData[filed]);
                }
            });
            gUpdateData = mergeUpdateData(gUpdateData, currentFormData);
        });
        gUpdateData.serviceFee = addBasicInfo([gUpdateData.serviceFee], gSerViceDataList, true)[0];
        gUpdateData.serviceFee.companyAccountId = 1;
        gUpdateData = convertDateData(gUpdateData, '-');
        gUpdateData = convertFormData(gUpdateData, gConvertData, true);
        var _sendData = gUpdateData;
        delete _sendData.customerNumber;//后台不接收此字段
        return gUpdateData.id !== undefined ? editTransaction(_sendData) : addTransaction(_sendData);
    }

    function addTransaction(sendData) {
        var _sendData = JSON.stringify(sendData);
        gRequest.postRemoteData(gDealKey, "add", _sendData).done(function (_result) {
            if (_result.code === 0) {
                $.messager.alert('Info', 'add data success!');
            } else {
                $.messager.alert('Alert', 'add data failed!' + _result.msg);
            }
        });
    }

    function editTransaction(sendData) {
        gRequest.putRemoteData(gDealKey, "edit", sendData).done(function (_result) {
            if (_result.code === 0) {
                $.messager.alert('Info', 'save data success!');
            } else {
                $.messager.alert('Alert', 'save data failed!' + _result.msg);
            }
        });
    }

    function newData(element) {
        var _id = -1;
        var _pLocation = '';
        switch (element) {
            case "#arrivesTable":
                _pLocation = "UI/Transaction/ReceiptArrivesForm.html?id=" + _id + "&transactionId=" + gUpdateData.id + "&customerId=" + gUpdateData.customerId + "&customerAccountType=" + gUpdateData.customerAccountType;
                $("#ifrmEdit").attr("src", _pLocation);
                constructDialog($('#dlg'), "arrives", 400, 400);
                AddDialog.dialog('open');
                break;
            case "#paysTable":
                _id = -1;
                _pLocation = "UI/Transaction/ReceiptPaysForm.html?id=" + _id + "&transactionId=" + gUpdateData.id + "&customerId=" + gUpdateData.customerId + "&customerAccountType=" + gUpdateData.customerAccountType;
                $("#ifrmEdit").attr("src", _pLocation);
                constructDialog($('#dlg'), "pays", 400, 400);
                AddDialog.dialog('open');
                break;
            default:
                $(element).edatagrid('addRow');
                break;
        }
    }

    function confirm(value) {
        var _sendData = {};
        switch (value) {
            case "#paysTable":
                var currentPayId = $("#paysTable").datagrid("getSelections")[0];
                if (currentPayId === undefined) {
                    alertMsg('please check selection');
                    break;
                }
                currentPayId = currentPayId.id;
                _sendData = {id: gUpdateData.id, mixId: currentPayId};
                $.messager.confirm("Info", "confirm to Verify Data", function (r) {
                    if (r) {
                        gRequest.putRemoteData(gDealKey, "verifyPay", _sendData).done(function (result) {
                            if (result.code === 0) {
                                $.messager.alert("Info", result.msg);
                            } else {
                                $.messager.alert("Info", result.msg);
                            }
                        });
                    }
                });
                break;
            case "#arrivesTable":
                var currentArriveId = $("#arrivesTable").datagrid("getSelections")[0];
                if (currentArriveId === undefined) {
                    alertMsg('please check selection');
                    break;
                }
                currentArriveId = currentArriveId.id;
                _sendData = {id: gUpdateData.id, mixId: currentArriveId};
                $.messager.confirm("Info", "confirm to Verify Data", function (r) {
                    if (r) {
                        gRequest.putRemoteData(gDealKey, "verifyArrive", _sendData).done(function (result) {
                            if (result.code === 0) {
                                $.messager.alert("Info", result.msg);
                            } else {
                                $.messager.alert("Info", result.msg);
                            }
                        });
                    }
                });
                break;
            default:
                break;
        }
    }

    function deleteItem(gridId) {
        var row = deepCopy($(gridId).datagrid('getSelected'));
        if (row) {
            $.messager.confirm('Confirm', 'Are you sure delete this record ?', function (r) {
                if (r) {
                    switch (gridId) {
                        case "#arrivesTable":
                            gRequest.putRemoteData(gDealKey, 'delArrive', {
                                mixId: row.id,
                                id: gCurrid
                            }).done(function (result) {
                                if (result.code === 0) {
                                    alertMsg('success!');
                                } else {
                                    alertMsg('failed!' + result.msg);
                                }
                                loadGridData();
                            });
                            break;
                        case '#paysTable':
                            gRequest.postRemoteData(gDealKey, 'delPay', JSON.stringify({
                                mixId: row.id,
                                id: gCurrid
                            })).done(function (result) {
                                if (result.code === 0) {
                                    alertMsg('success!');
                                } else {
                                    alertMsg('failed!' + result.msg);
                                }
                                loadGridData();
                            });
                            break;
                        default:
                            break;
                    }
                }
            });
        } else {
            alertMsg('please check selection!');
        }
    }

    function destroy(element) {
        $(element).edatagrid('destroyRow');
    }

    function thirdTransaction() {
        var _pLocation = "UI/Transaction/ThirdTransaction.html?transactionId=" + gUpdateData.id + "&customerId=" + gUpdateData.customerId + "&CurrencyCode="+gUpdateData.fromCurrencyCode;
        $("#ifrmEdit").attr("src", _pLocation);
        constructDialog($('#dlg'), "Third Transaction", 1000, 620);
        AddDialog.dialog('open');
    }

    function closeDlg(data) {
        AddDialog.dialog('close');
        loadGridData();
    }

</script>
</body>
</html>
