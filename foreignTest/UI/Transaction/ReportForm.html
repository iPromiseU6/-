<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<form id="ff">
    <div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>Type:</span>
            <input type="text" class="easyui-textbox" id="input_type"
                   style="width: 65%"/>
        </div>
        <div id="div_account">
            <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
                <span style='margin-right: 5px'>account:</span>
                <input type="text" class="easyui-textbox" id="input_accountId"
                       style="width: 65%"/>
            </div>
        </div>
        <div id="div_entity">
            <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
                <span style='margin-right: 5px'><span class="required">*</span>Entity:</span>
                <input type="text" class="easyui-textbox" id="input_entityId"
                       style="width: 65%"/>
            </div>
        </div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>Payment:</span>
            <input type="text" class="easyui-textbox" id="input_payment"
                   style="width: 65%"/>
        </div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>CompanyAccount:</span>
            <input type="text" class="easyui-textbox" id="input_companyAccountId"
                   style="width: 65%"/>
        </div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>Amount:</span>
            <input type="text" class="easyui-numberbox" id="input_foreignAmount"
                   style="width: 65%"/>
        </div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'><span class="required">*</span>fundsCode:</span>
            <input type="text" class="easyui-textbox" id="input_fundsCode"
                   style="width: 65%"/>
        </div>
        <div style="margin-top: 20px;margin-right: 20px;display: flex;justify-content:flex-end">
            <span style='margin-right: 5px'>Comments:</span>
            <input type="text" class="easyui-textbox" id="input_fundsComment"
                   style="width: 65%"/>
        </div>

    </div>
    <div class="submit_button">
        <a class="easyui-linkbutton" iconCls="icon-save" onclick="saveRowData()" style="width: 100px;">Save</a>
        <a class="easyui-linkbutton" iconCls="icon-reload" onclick="cancel()" style="width: 100px;">Cancel</a>
    </div>
</form>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/BasicPreview.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="../../JS/Header.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicDetail.js"></script>
<script type="text/javascript" src="../../JS/jquery.edatagrid.js"></script>
<script type="text/javascript" src="./ReceiptDetailCommon.js"></script>
<script type="text/javascript">

    var gAPiKey = "DEAL";
    var gRowId = getMultiID().rowIndex;
    var gGridId = getMultiID().gridId;
    var gRequestHandle = new RequestHandle();
    var myConvertData = {};
    var gOriginData = {};

    init();

    $(function () {
        var parentLocation = searchParent("ReportDetail.html");
        var currentRow = deepCopy(parentLocation.getRow(gGridId));
        gOriginData = deepCopy(currentRow);
        currentRow = setAccountType({text: currentRow.type}, currentRow);
        getFormData(currentRow);
    });

    function init() {
        createComponentFactory("TRANSACTION_TYPE", '#input_type', gComboboxConfig);
        createComponentFactory("TRANSACTION_PAYMENTTYPE", '#input_payment', gComboboxConfig);
        createComponentFactory("FUNDSCODE", "#input_fundsCode", gComboboxConfig);
        createComponentFactory("REPORT_ACCOUNT_COMPANY", "#input_companyAccountId", gComponyAccountConfig);
        createComponentFactory("TRANSACTION_ENTITY", "#input_entityId", gComboboxConfig);
        createComponentFactory("TRANSACTION_ACCOUNT", "#input_accountId", gComboboxConfig);
        bundleEvent();
    }

    function cancel() {
        clearFormData();
        var parentLocation;
        parentLocation = searchParent("ReportDetail.html");
        parentLocation.AddDialog.dialog('close');
    }

    function saveRowData() {
        var formData = submitFormData();
        var parentLocation = searchParent("ReportDetail.html");
        Object.keys(formData).forEach(function (filed) {
            if (gConvertFieldData[filed]) {
                formData[filed] = typeof formData[filed] === 'number' ? formData[filed] : window['parse' + gConvertFieldData[filed]](formData[filed]);
            }
        });
        formData = mergeUpdateData(gOriginData, formData);
        parentLocation.reloadGridData(gGridId, formData, gRowId);
        parentLocation.reportData(gGridId,gRowId);
        cancel();
    }

    function bundleEvent() {
        $("#input_type").combobox({
            onSelect: function (e) {
                return setAccountType(e);
            }
        });
        $("#input_accountId").combobox({
            onShowPanel: function () {
                var _data = JSON.parse(localStorage.getItem('currentAccount'));
                $(this).combobox("loadData", _data || []);
            }
        });
        $("#input_entityId").combobox({
            onShowPanel: function () {
                var _data = JSON.parse(localStorage.getItem('currentEntity'));
                $(this).combobox("loadData", _data || []);
            }
        });
    }

    function setAccountType(e, row) {
        switch (e.text) {
            case "Account":
                $("#div_account").css("display", "block");
                $("#div_entity").css("display", "none");
                break;
            case "Entity":
                $("#div_account").css("display", "none");
                $("#div_entity").css("display", "block");
                break;
            default:
                $("#div_account").css("display", "none");
                $("#div_entity").css("display", "none");
                break;
        }
        return row;
    }


</script>
</html>
