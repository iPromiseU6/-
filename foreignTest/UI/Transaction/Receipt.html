<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div id="div_search" data-options="region:'north'">
    </div>
    <div data-options="region:'center'">
        <div class="easyui-panel" title="数据列表">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="easyui-dialog" closed="true">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="ReceiptDetailCommon.js"></script>
<script>
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var gApiKey = "DEAL";
    var gSearchOptions = gSearchSetting;
    gBasicList.createSearch(gSearchOptions);


    var gToolbarOptions = DATAGRID_TOOLBAR_ADD;
    gToolbarOptions += DATAGRID_TOOLBAR_EDITOR;
    gToolbarOptions += DATAGRID_TOOLBAR_DELETE;
    gBasicList.createToolbar(gToolbarOptions);

    var gDatagridUrl = RequestUrl.constructURL(gApiKey, "list");
    var gConfig = {
        url : gDatagridUrl,
        method : "put",
        queryParams : {status : 0},
        columns : gTransactionColumnConfig,
        onDblClickRow : function (index, row) {
            var pLocation = "UI/Transaction/ReceiptDetail.html?id=" + row.id;
            AddTabIn("ReceiptDetail", parent.$('#tabs'), pLocation);
        },
    };
    gBasicList.createDataGrid(gConfig);

    $(document).ready(function () {
        getNameData();
    });


    //获取下拉框中的名字信息
    function getNameData() {
        var _sendData = {status : 0};
        gRequest.putRemoteData(gApiKey, "list", _sendData).done(function (_result) {
            if (_result.code === 0) {
                nameData = _result.data.data;
                $("#search_receipt_firstName").combobox({
                    data : nameData,
                });
            }
        });
    }

    function doSearch() {
        var _searchCondition = processSearchConditionObject();
        if (_searchCondition.createTimeStart) {
            _searchCondition.createTimeStart = new Date(_searchCondition.createTimeStart).format("yyyy-MM-dd hh:mm:ss");
        }
        if (_searchCondition.createTimeEnd) {
            _searchCondition.createTimeEnd = new Date(_searchCondition.createTimeEnd).format("yyyy-MM-dd hh:mm:ss");
        }
        gRequest.putRemoteData(gApiKey, "list", _searchCondition).done(function (result) {
            if (result.code === 0) {
                $("#dg").datagrid('loadData', result.data.data);
            } else {
                $.messager.alert("Fail", result.msg);
            }
        });
    }

    function doReset() {
        $(".easyui-combobox").each(function (index) {
            $(this).combobox('clear');
        });
        $(".easyui-datebox").each(function (index) {
            $(this).combobox('clear');
        });
    }


    function destroy() {
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you want to delete");
            return;
        }
        var _sendData = {id : _row.id};
        $.messager.confirm("Alert", "are you sure delete this record?", function (r) {
            if (r) {
                gRequest.delRemoteData(gApiKey, "del", JSON.stringify(_sendData)).done(function (result) {
                    if (result.code === 0) {
                        $.messager.alert("Alert", "delete success!");
                        gBasicList.resetHandle(gApiKey);
                    } else {
                        $.messager.alert("Alert", result.msg);
                    }
                });
            }
        });
    }

    function newData() {
        var _config = {dialogWidth : 580, dialogHeight : 400};
        var _pLocation = "UI/Transaction/ReceiptCreate.html?id=-1";
        newHandle(_pLocation, _config);
    }

    function editData() {
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you want to update");
            return;
        }
        var id = _row.id;
        var _pLocation = "UI/Transaction/ReceiptDetail.html?id=" + id;
        AddTabIn("ReceiptDetail", parent.$('#tabs'), _pLocation);
    }

    function dialogClose() {
        AddDialog.dialog('close');
    }

    function newHandle(openUrl, config) {
        var pLocation = openUrl;
        $("#ifrmEdit").attr("src", pLocation);
        constructDialog($('#dlg'), "create", config.dialogWidth, config.dialogHeight);
        AddDialog.dialog('open');
    }

    function constructDialog(dlgname, ptitle, pwidth, pheight) {
        var html = dlgname.html();
        AddDialog = window.parent.$(html).appendTo(window.top.document.body);
        AddDialog.dialog({
            modal : true,
            title : ptitle,
            cache : true,
            closable : true,
            draggable : true,
            width : pwidth,
            height : pheight,
        }).dialog('close');
    }

</script>
</body>
</html>
