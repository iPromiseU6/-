<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div id="div_search" data-options="region:'north'">
    </div>
    <div data-options="region:'center'">
        <div class="easyui-panel" title="数据列表">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="easyui-dialog" closed="true">
    <iframe id="ifrmEdit" class="easyui-linkbutton" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="ReceiptDetailCommon.js"></script>
<script>
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var gApiKey = "DEAL";
    var gSearchOptions = gSearchSetting;
    gBasicList.createSearch(gSearchOptions);

    var gToolbarOptions = DATAGRID_TOOLBAR_EDITOR;
    gBasicList.createToolbar(gToolbarOptions, "");//创建toolbar

    var gDatagridUrl = RequestUrl.constructURL(gApiKey, "list");
    var gConfig = {
        url: gDatagridUrl,
        method: "put",
        // queryParams: {status: "4"},
        columns : gTransactionColumnConfig,
        onDblClickRow: function (index, row) {
            if(row.status<4)
            {
                $.messager.alert('Info', "the transaction status must be [deal complete]");
                return;
            }
            var pLocation = "UI/Transaction/ReportDetail.html?id=" + row.id;
            AddTabIn("ReportDetail", parent.$('#tabs'), pLocation);
        },
    };
    gBasicList.createDataGrid(gConfig);

    $(document).ready(function () {
        getNameData();
    });

    function getNameData() {
        var _sendData = {status: 0};
        gRequest.putRemoteData(gApiKey, "list", _sendData).done(function (_result) {
            if (_result.code === 0) {
                nameData = _result.data.data;
                $("#search_receipt_firstName").combobox({
                    data: nameData,
                });
            }
        });
    }

    function doSearch() {
        var _searchCondition = processSearchConditionObject();
        var _createTime = [];
        _createTime.push(_searchCondition.startTime);
        _createTime.push(_searchCondition.endTime);
        var _sendData = {
            username: _searchCondition.firstName,
            createTime: _createTime
        };
        gRequest.putRemoteData(gApiKey, "list", _sendData).done(function (result) {
            if (result.code === 0) {
                $("#dg").datagrid('loadData', result.data.data);
            } else {
                $.messager.alert("Fail", result.msg);
            }
        });
    }

    function doReset() {
        $(".easyui-combobox").each(function (index) {
            $(this).combobox('clear');
        });
        $(".easyui-datebox").each(function (index) {
            $(this).combobox('clear');
        });
    }

    function reported() {
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "please select your data!");
            return;
        }
        var _sendData = {id: _row.id};
        gRequest.putRemoteData(gApiKey, "reported", _sendData).done(function (result) {
            if (result.code === 0) {
                $("#dg").datagrid('loadData', result.data.data);
            } else {   ////原系统中返回code为1时没有提示
                $.messager.alert("Fail", result.msg);
            }
        });
    }

    function editData() {
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "please select your data!");
            return;
        }
        if(_row.status<4)
        {
            $.messager.alert('Info', "the transaction status must be [deal complete]");
            return;
        }
        var _pLocation = "UI/Transaction/ReportDetail.html?id=" + _row.id;
        AddTabIn("ReportDetail", parent.$('#tabs'), _pLocation);

    }

</script>
</body>
</html>
