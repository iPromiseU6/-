<!--创建人：吴永佳-->
<!--创建时间：2018.12.2-->
<!--描述：对ExchangeRateList的修改，新增页面-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/BasicDataPreview.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/BasicInfoCommon.css">
</head>
<body>
<div id="div_content">
    <div id="bigTitle" style="font-size: 25px;padding-left: 20px"></div>
    <form id="ff">
        <table id="basicData" class="displaytable" style="text-align: left;padding:20px;">
            <tr id="display_tr">
                <td width="15%"><span class="redTip">*</span>currencyFrom:</td>
                <td width="25%">
                    <input type="text" class="easyui-combobox" data-options='required:true' style="width: 80%"
                           id="input_currencyCodeFrom"/>
                </td>
                <td width="15%"><span class="redTip">*</span>currencyTo:</td>
                <td width="25%">
                    <input type="text" class="easyui-combobox" data-options='required:true'  style="width: 80%"
                           id="input_currencyCodeTo"/>
                </td>
            </tr>
            <tr>
                <td width="15%"><span class="redTip">*</span>Buy T/T Offset:</td>
                <td width="25%">
                    <input type="text" class="easyui-numberbox" data-options='required:true,min:-9999,precision:3'  style="width: 80%"
                           id="input_buyingBankRate1"/>
                </td>
                <td width="15%"><span class="redTip">*</span>Buy Cash Offset:</td>
                <td width="25%">
                    <input type="text" class="easyui-numberbox" data-options='required:true,min:-9999,precision:3'  style="width: 80%"
                           id="input_buyingRate1"/>
                </td>
            </tr>
            <tr>
                <td width="20%"><span class="redTip">*</span>Sell T/T Offset:</td>
                <td width="30%">
                    <input type="text" class="easyui-numberbox" data-options='required:true,min:-9999,precision:3'  style="width: 80%"
                           id="input_sellingBankRate1"/>
                </td>
                <td width="20%"><span class="redTip">*</span>Sell Cash Offset:</td>
                <td width="30%">
                    <input type="text" class="easyui-numberbox" data-options='required:true,min:-9999,precision:3'  style="width: 80%"
                           id="input_sellingRate1"/>
                </td>
            </tr>
            <tr>
                <td width="20%"><span class="redTip">*</span>Sort:</td>
                <td width="30%">
                    <input type="text" class="easyui-textbox" data-options='required:true' id="input_sort"  style="width: 80%"/>
                </td>
            </tr>
        </table>
        <div style="padding-left: 26px">
            <span style="float: left">Memo:</span>
            <div style="padding-left: 120px">
                <input type="text" class="easyui-textbox" id="input_memo" style="width: 448px;height: 40px;"/>
            </div>
        </div>
    </form>
    <div class="submit_button" style="margin-left: 50px;">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" onclick="save()"
           style="width:100px;margin-left: -70px;">Save</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" onclick="_close()"
           style="width:100px;margin-left: 70px;">Cancel</a>
    </div>
</div>
</body>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/BasicPreview.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript">
    //创建请求对象
    var gRequest = new RequestHandle();
    //拿到传过来的参数
    var gParam = getID();
    //接口
    var gApiKey = "RSET";
    //全局使用的数据
    var getData;
    // createComponentFactory("BASICDATA_NAME", '#input_type', gconfig);

    var gComboboxConfig = {
        panelWidth: 265,
        panelHeight: 150,
    };
    $(document).ready(function () {
        createComponentFactory("BASICDATA_CURRENCIES", '#input_currencyCodeFrom', gComboboxConfig);
        createComponentFactory("BASICDATA_CURRENCIES", '#input_currencyCodeTo', gComboboxConfig);
        if (gParam) {
            //移除新增页面时的<tr>
            $("#display_tr").remove();
            //对List页面传过来的参数进行拆分组装
            var _currencyCodeFrom = gParam.split("_")[0];
            var _currencyCodeTo = gParam.split("_")[1];
            var _param = {
                currencyCodeFrom: _currencyCodeFrom,
                currencyCodeTo: _currencyCodeTo
            };
            //发送请求，并用getFormData同步input框内的数据
            var _res;
            _res = gRequest.putRemoteData(gApiKey, "list", _param);
            _res.done(function (data) {
                getData = data.data.data[0];
                getFormData(data.data.data[0]);
                $('#bigTitle').append(getData.currencyCodeFrom + '->' + getData.currencyCodeTo)
            });
        }
    });

    //关闭
    function _close() {
        var parentLocation;
        parentLocation = searchParent("ExchangeRateList.html");
        parentLocation.dialogClose();
    }

    function save() {
        var _isValid = $("#ff").form('validate');
        if (!_isValid) {
            $.messager.alert("Info", "Required entries not filled in");
            return;
        }
        saveData();
    }

    function saveData() {
        var _data = submitFormData();
        var _postData = $.extend(false, getData, _data);
        if (gParam) {
            //Updata时的操作，由于method不同和params的格式问题，所以分成两块
            gRequest.putRemoteData(gApiKey, 'edit', _postData).complete(function (result) {
                result = result.responseJSON;
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("ExchangeRateList.html");
                    parentLocation.dialogClose();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        } else {
            data = JSON.stringify(_postData);
            gRequest.postRemoteData(gApiKey, 'add', data).complete(function (result) {
                result = result.responseJSON;
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("ExchangeRateList.html");
                    parentLocation.dialogClose();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        }
    }
</script>
</html>