<!--创建人：吴永佳-->
<!--创建时间：2018.12.2-->
<!--描述：展示ExchangeRate-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<style>
</style>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div id="div_search" data-options="region:'north'">
    </div>
    <div data-options="region:'center'">
        <div class="easyui-panel" title="DataList">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="hiddenDialog">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script>
    var gBasicList = new BasicListPage();
    var gDialogWidth = 700;
    var gDialogHeight = 380;
    var gApiKey = "RATE";
    var gData;
    var gRequest = new RequestHandle();
    gBasicList.createSearch(SEARCH_EXCHANGEREATE_CURRENCYCODEFROM + SEARCH_EXCHANGEREATE_CURRENCYCODETO);
    gBasicList.createToolbar(DATAGRID_TOOLBAR_EDITOR + DATAGRID_TOOLBAR_DELETE + DATAGRID_TOOLBAR_ADD);
    var gDatagridUrl = RequestUrl.constructURL(gApiKey, "list");
    var gConfig = {
        url: gDatagridUrl,
        method: 'put',
        singleSelect: true,
        columns: [
            [{
                field: 'updateTime1',
                title: 'Update time',
                width: '15%',
                align: 'center',
            }, {
                field: 'currencyCodeFrom',
                title: 'Currency Code',
                width: '10%',
                align: 'center',
                formatter: function (value, row) {
                    return row.currencyCodeFrom + '->' + row.currencyCodeTo;
                }
            }, {
                field: 'buyingBankRate1',
                title: 'Buy T/T',
                width: '12%',
                align: 'center',
            }, {
                field: 'buyingRate1',
                title: 'Buy Cash',
                width: '12%',
                align: 'center',
            }, {
                field: 'sellingBankRate1',
                title: 'Sell T/T',
                width: '12%',
                align: 'center',
            }, {
                field: 'sellingRate1',
                title: 'Sell Cash',
                width: '12%',
                align: 'center',
            }, {
                field: 'exchangeRate1',
                title: 'Exchange Rate',
                width: '12%',
                align: 'center',
            }
            ]
        ],
        onDblClickRow: function (index, row) {
            var pLocation = "UI/BasicInfo/ExchangeRateDetail.html?id=" + row.currencyCodeFrom + '_' + row.currencyCodeTo;
            $("#ifrmEdit").attr("src", pLocation);
            constructDialog($('#dlg'), 'Update', gDialogWidth, gDialogHeight);
            AddDialog.dialog('open');
        },
    };
    gBasicList.createDataGrid(gConfig);
    /***
     * 函数
     */
    $(document).ready(function () {
        getData();
    })

    function getData() {
        var _ApiKey = 'BASECODE'
        var _sendData = JSON.stringify({type: "Currencies"});
        gRequest.postRemoteData(_ApiKey, "allbrif", _sendData).done(function (_result) {
            if (_result.code === 0) {
                gData = _result.data;
                $("#search_exchangeRate_currencyCodeFrom").combobox({
                    data: gData,
                })
                $("#search_exchangeRate_currencyCodeTo").combobox({
                    data: gData,
                })
            }
        })
    }

    function doSearch() {
        //获取搜索框的内容
        var _searchCondition = processSearchConditionObject();
        //发送请求，并更新列表
        gRequest.putRemoteData(gApiKey, "list", _searchCondition).complete(function (result) {
            var _data = result.responseJSON.data.data
            $('#dg').datagrid('loadData', _data);
        });
    }

    function doReset() {
        $("#dg").datagrid('reload')
        $(".easyui-combobox").each(function (index) {
            $(this).combobox('clear');
        });
    }

    function dialogClose() {
        AddDialog.dialog('close');
    }

    function editData() {
        var _gDialogHeight = gDialogHeight + 30;
        var _rowdata = $('#dg').datagrid('getSelected');
        if (!_rowdata) {
            $.messager.alert('Info', "Please choose one data");
            return;
        }
        var _currencyCodeFrom = _rowdata.currencyCodeFrom;
        var _currencyCodeTo = _rowdata.currencyCodeTo;
        var pLocation = "UI/BasicInfo/ExchangeRateDetail.html?id=" + _currencyCodeFrom + '_' + _currencyCodeTo;
        $("#ifrmEdit").attr("src", pLocation);
        constructDialog($('#dlg'), 'Update', gDialogWidth, _gDialogHeight);
        AddDialog.dialog('open');
    }

    function newData() {
        var _gDialogHeight = gDialogHeight + 30;
        var pLocation = "UI/BasicInfo/ExchangeRateDetail.html";
        $("#ifrmEdit").attr("src", pLocation);
        constructDialog($('#dlg'), 'Create', gDialogWidth, _gDialogHeight);
        AddDialog.dialog('open');
    }

    function destroy() {
        var _rowdata = $('#dg').datagrid('getSelected');
        if (!_rowdata) {
            $.messager.alert('Info', "Please choose one data");
            return;
        }
        var _id = _rowdata.id;
        var _sendData = {
            id: _id
        };
        $.messager.confirm('Confirm', 'Are you sure delete this record?', function (r) {
            if (r) {
                gRequest.delRemoteData(gApiKey, "del", JSON.stringify(_sendData)).done(function (result) {
                    destroySuccess(result);
                })
            }
        })
    }

    function destroySuccess(result) {
        $('#dg').datagrid('reload');
        if (result.code === -1) {
            $.messager.alert({
                title: 'Delete success!',
                msg: 'Ok'
            });
            return;
        } else {
            $.messager.alert({
                title: 'Info',
                msg: result.msg
            });
            return;
        }
    }
</script>
</html>