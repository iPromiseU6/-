<!--创建人：lhf-->
<!--创建时间：2018.1.3-->
<!--描述：基础数据类型详情页-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../Themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/demo.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>

<body style="padding: 0px;">
<div id="toolbar" class="receipts_toolbar_style"></div>
<form id="ff" style="width: 100%">
    <table id="sss" class="displayable" style="text-align:right;width: 100%;table-layout:fixed">
        <tr style="height: 50px">
            <td style="width: 10%;"><span style="color:red;">*</span>ContactType:</td>
            <td style="width: 35%;text-align: left;">
                <input type="text"  class="easyui-combobox" data-options='required:true' style="width: 85%;"
                       id="input_addressType"/>
            </td>
            <td style="width: 15%;"><span style="color:red;">*</span>Country:</td>
            <td style="width: 35%;text-align: left">
                <input type="text"  class="easyui-combobox" data-options='required:true' style="width: 85%;"
                       id="input_countryCode"/>
            </td>
        </tr>
        <tr style="height: 50px">
            <td >Subburb:</td>
            <td style=";text-align: left">
                <input type="text"  class="easyui-textbox" data-options='' style="width: 85%;"
                       id="input_state"/>
            </td>
            <td style="width: 10%;"><span style="color:red;">*</span>City:</td>
            <td style="width: 35%;text-align: left">
                <input type="text"  class="easyui-textbox" id="input_city" style="width: 80%;"
                       data-options="required:true"/>
            </td>
        </tr>
        <tr style="height: 50px">
            <td style="width: 15%;">PostCode:</td>
            <td style="width: 35%;text-align: left">
                <input type="text"  class="easyui-textbox" id="input_zip" style="width: 80%;"
                       data-options=""/>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td style="width: 15%"><span style="color:red;">*</span>Address:</td>
            <td style="text-align: left">
                <input type="text"  class="easyui-textbox" id="input_address" style="width: 225%;"
                       data-options="required:true,multiline:true"/>
            </td>
        </tr>
        <tr style="height: 80px;">
            <td style="padding-bottom: 40px">Comments:</td>
            <td style="text-align: left;align-content: center">
                <input type="text"  class="easyui-textbox" id="input_comments" style="width: 225%;height: 65%"
                       data-options="multiline:true"/>
            </td>
        </tr>
    </table>
    <div class="submit_button">
        <a class="easyui-linkbutton" iconCls="icon-save" onclick="save()" style="width: 100px;"> 保存</a>
        <a class="easyui-linkbutton" iconCls="icon-reload" onclick="cls()"
           style="width: 100px;margin-left: 10px;">Reset</a>
    </div>
</form>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
</body>
<script type="text/javascript">
    var gData = JSON.parse(localStorage.getItem("reportAddrData"));
    var gEnNumRegular = /^[A-Za-z0-9\-\s]+$/;
    var gEnRegular = /^[A-Z\-]+$/;
    var gNumRegular = /^[0-9\-]+$/;
    var gRequest = new RequestHandle();
    var gApiKey = "REPORTBASE";
    var gCurrid = Number(getID());
    var gComboboxConfig = {//配置combobox
        panelWidth:230,
        //value:'I',
        onHidePanel: checkCombobox,
    };
    //构造combobox
    createComponentFactory("BASICDATA_CONTACTTYPE", '#input_addressType',gComboboxConfig);
    createComponentFactory("BASICDATA_COUNTRYCODES", '#input_countryCode',gComboboxConfig);
    $(document).ready(function () {
        if (gCurrid !== AddFlag) {
            gData.forEach(function(item) {
                if(item.id === gCurrid) {
                    getFormData(item);
                }
            })
        }
        else {
            gCurrid = AddFlag;
        }
    });
    $.extend($.fn.validatebox.defaults.rules, {
        gPattern: {
            validator: function (value, param) {
                return param[0].test(value);
            },
            message: 'bad format!'
        }
    });
    function cls() {
        $('#ff').form('reset');
    }
    function save() {
        var flag=checkInput()
        if(flag){
            saveData();
        }
    }

    function saveData() {
        var _data = submitFormData();
        if(gCurrid===AddFlag){
            for(var i in _data){
                if(_data[i]===""){
                   delete _data[i];
                }
            }
            _data = $.extend(false,_data,{personId:'1'});
            gRequest.postRemoteData(gApiKey,'addr/add',JSON.stringify(_data)).done(function(result){
                if (result.code === 0) {
                    $.messager.alert("Info", result.msg);
                    var parentLocation;
                    parentLocation = searchParent("ReportAddress.html");
                    parentLocation.closeDlg();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        }
        else{
            for(var i in _data){
                if(_data[i]===""){
                    _data[i] = null;
                }
            }
            _data = $.extend(false,_data,{id:gCurrid,personId:'1'});
            gRequest.putRemoteData(gApiKey,'addr/edit',_data).done(function(result){
                if (result.code === 0) {
                    $.messager.alert("Info", result.msg);
                    var parentLocation;
                    parentLocation = searchParent("ReportAddress.html");
                    parentLocation.closeDlg();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        }
    }
</script>
</html>