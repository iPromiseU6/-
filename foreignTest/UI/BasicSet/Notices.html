<!--创建人：lhf-->
<!--创建时间：2018.1.3-->
<!--描述：Notices页-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div id="div_search" data-options="region:'north'">
    </div>
    <div data-options="region:'center'">
        <div class="easyui-panel" title="Data List">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="easyui-dialog" closed="true">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script>
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var config = {dialogWidth: 400, dialogHeight: 360};
    var gApiKey= "NOTICES";
    var gSearchOptions = SEARCH_RECEIPT_CREATETIME_START;
    gSearchOptions += SEARCH_RECEIPT_CREATETIME_END;
    gBasicList.createSearch(gSearchOptions);//创建搜索界面

    var content = DATAGRID_TOOLBAR_EDITOR;
    content+=DATAGRID_TOOLBAR_DELETE;
    content+=DATAGRID_TOOLBAR_ADD;
    content+=DATAGRID_TOOLBAR_PUBLISH;
    gBasicList.createToolbar(content);//创建toolbar

    var gDatagridUrl = RequestUrl.constructURL(gApiKey, "listbrif");
    var gConfig = {
        queryParams:{pagenum: 10},
        singleSelect: true,
        columns : [
            [{
                field: 'ck',
                checkbox: 'true',
            },{
                field : 'title',
                title : 'Title',
                width : '25%',
                align : 'center',
            },{
                field : 'status',
                title : 'Status',
                width : '25%',
                align : 'center',
            }]
        ],
        onDblClickRow: function (index, row) {
            var _DialogWidth=400;
            var _DialogHeight=360;
            var pLocation = "UI/BasicSet/NoticesDetail.html?id="+ row.id;
            $("#ifrmEdit").attr("src", pLocation);
            constructDialog($('#dlg'), 'Info', _DialogWidth, _DialogHeight);
            AddDialog.dialog('open');
        },
    }
    gBasicList.createDataGrid(gConfig);

    $(document).ready(function(){
        getData();
    });

    function getData(){
        var _sendData ={page: 1,pagenum: 10};
        gRequest.postRemoteData(gApiKey,"listbrif",JSON.stringify(_sendData)).done(function(result){
            var _data = result.data.data;
            _data.forEach(function (item) {
                if (item.status === 0) {
                    item.status =  'draft'
                } else {
                    item.status = 'published'
                }
            });
            $("#dg").datagrid('loadData',_data)
        })
    }
    function doSearch(){
        var _searchCondition = processSearchConditionObject();

        var _createTime = [];
        _createTime.push(_searchCondition.startTime);
        _createTime.push(_searchCondition.endTime);
        var _sendData = {
            username:_searchCondition.firstName,
            createTime:_createTime
        }
        gRequest.postRemoteData(gApiKey,"listbrif",JSON.stringify(_sendData)).done(function (result) {
            if(result.code===0){
                var _data = result.data.data;
                _data.forEach(function (item) {
                    if (item.status === 0) {
                        item.status =  'draft'
                    } else {
                        item.status = 'published'
                    }
                });
                $("#dg").datagrid('loadData',_data)
            }
            else{
                $.messager.alert("Fail", result.msg);
            }
        })
    }
    function doReset() {
        $(".easyui-combobox").each(function (index) {
            $(this).combobox('clear');
        });
        $(".easyui-datebox").each(function(index){
            $(this).combobox('clear');
        })
    }
    function editData() {
        var _row = $("#dg").datagrid("getSelected");
        gBasicList.editHandle("UI/BasicSet/NoticesDetail.html?id=", config);
    }
    function newData() {
        gBasicList.newHandle("UI/BasicSet/NoticesDetail.html?id=-1", config);
    }
    function closeDlg() {
        getData();
        AddDialog.dialog('close')
    }
    function destroy(){
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you need to modify.");
            return;
        }
        $.messager.confirm("Info", "confirm to Delete Data", function (r) {
            if (r) {
                var _param = {personId: "1", type: "reportBaseAddress"};
                var _currentId = {id:_row.id};
                _param = $.extend(false,_param,_currentId);
                gRequest.delRemoteData(gApiKey,"del",JSON.stringify(_param)).done(function (result) {
                    if(result.code === 0){
                        $.messager.alert("Info",result.msg)
                        getData()
                    }else{
                        $.messager.alert("Info",result.msg)
                    }
                })
            }
        })
    }
    function publishNotice() {
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you need to modify.");
            return;
        }
        if (_row.status === "published") {
            $.messager.alert('Info', "Published,Already!!");
            return;
        }
        $.messager.confirm("Info", "confirm to Publish "+_row.title, function (r) {
            if (r) {
                gRequest.putRemoteData(gApiKey,"get",{id:_row.id}).done(function (result) {
                    gRequest.putRemoteData(gApiKey,'publishDraftNotice',result.data).done(function(res){
                        if(result.code === 0){
                            $.messager.alert("Info","publish "+result.msg)
                            getData()
                        }else{
                            $.messager.alert("Info","publish "+result.msg)
                        }
                    })
                })
            }
        })
    }
</script>
</body>
</html>