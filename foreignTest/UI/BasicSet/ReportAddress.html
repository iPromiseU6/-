<!--创建人：lhf-->
<!--创建时间：2018.1.4-->
<!--描述：地址类型展示页面框架-->

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<style>
</style>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div data-options="region:'center'">
        <div class="easyui-panel" title="Data List">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="hiddenDialog">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script>
    var postData = {type: "CountryCodes"};
    var config = {dialogWidth: 800, dialogHeight: 400};
    var AddDialog;
    var nameData//保存从服务器拿到的数据
    //声明
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var gApiKey1 = "BASECODE";
    var gApiKey2 = "REPORTBASE";
    var gEditOpenUrl = "UI/BasicSet/ReportAddressDetail.html?id=";
    var gAddOpenUrl = "UI/BasicSet/ReportAddressDetail.html?id=-1";
    ////主流程
    var content = DATAGRID_TOOLBAR_EDITOR;
    content+=DATAGRID_TOOLBAR_DELETE;
    content+=DATAGRID_TOOLBAR_ADD;
    gBasicList.createToolbar(content);//创建toolbar
    ////创建表格
    var gConfig = {
        toolbar: '#toolbar',
        fitColumns: 'false',
        rownumbers: 'true',
        singleSelect : true,
        width: '100%',
        height:"500px",
        striped: 'true',
        loadMsg: 'Is struggling to load.....',
        showFooter: 'true',
        columns : [
            [{
                field: 'ck',
                checkbox: 'true',
            },{
                field : 'id',
                title : 'id',
                width : '0%',
                align : 'center'
            }, {
                field : 'addressType',
                title : 'Type',
                width : '15%',
                align : 'center',
                formatter: function (value, row, index) {
                    var gConvertData = {src:'ContactType',key:"code",value:"name"};
                    return convertDictData(value,gConvertData);;
                }
            }, {
                field : 'address',
                title : 'Address',
                width : '25%',
                align : 'center',
            }, {
                field : 'countryCode',
                title : 'Country',
                width : '25%',
                align : 'center',
                formatter: function (value, row, index) {
                    var gConvertData = {src:'CountryCodes',key:"code",value:"name"};
                    return convertDictData(value,gConvertData);;
                }
            },{
                field : 'zip',
                title : 'Zip',
                width : '25%',
                align : 'center'
            }]
        ],
        onDblClickRow : function (index, row) {
            var _DialogWidth=800;
            var _DialogHeight=400;
            var pLocation = "UI/BasicSet/ReportAddressDetail.html?id="+ row.id;
            $("#ifrmEdit").attr("src", pLocation);
            constructDialog($('#dlg'), 'Info', _DialogWidth, _DialogHeight);
            AddDialog.dialog('open');
        },
    }
    $("#dg").datagrid(gConfig);
    gBasicList.hideColumn(['id']);//隐藏id
    $(document).ready(function () {
        getData();
    });
    function getData() {
        var _res = gRequest.putRemoteData(gApiKey2, "addr/list",{
            id: "1",
            type: "reportBaseAddress",
        }).done(function (result) {
            if (result.code === 0) {
                var addressData = result.data;
                localStorage.removeItem('reportAddrData');
                localStorage.setItem("reportAddrData",JSON.stringify(addressData));
                $("#dg").datagrid("loadData",addressData)
            } else {
                $.messager.alert("Failed", _result.msg);
            }
        });
    }
    function editData() {
        var _row = $("#dg").datagrid("getSelected");
        gBasicList.editHandle(gEditOpenUrl, config);
    }
    function newData() {
        gBasicList.newHandle(gAddOpenUrl, config);
    }
    function closeDlg() {
        getData();
        AddDialog.dialog('close')
    }
    function destroy(){
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you need to modify.");
            return;
        }
        $.messager.confirm("Info", "confirm to Delete Data", function (r) {
            if (r) {
                var _param = {personId: "1", type: "reportBaseAddress"};
                var _currentId = {id:_row.id};
                _param = $.extend(false,_param,_currentId);
                gRequest.delRemoteData(gApiKey2,"addr/del",JSON.stringify(_param)).done(function (result) {
                    if(result.code === 0){
                        $.messager.alert("Info",result.msg)
                        getData()
                    }else{
                        $.messager.alert("Info",result.msg)
                    }
                })
            }
        })
    }
</script>

</html>
