<!--创建人：简佳成-->
<!--创建时间：2018.12.1-->
<!--描述：基础数据类型详情页-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/demo.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <style>
        .required{
            color: red;
        }
    </style>
</head>

<body style="padding: 0px;">
<div id="toolbar" class="receipts_toolbar_style"></div>
<form id="ff">
    <table id="basicData" class="displaytable" style="text-align: left;padding:20px;">
        <tr >
            <td width="15%" style="text-align: right"><span class="required">*</span>Name:</td>
            <td width="45%">
                <input type="text" style="width: 80%" class="easyui-textbox" data-options="required:true,validType:'gPattern[gEnNumRegular]'"
                       id="input_name"/>
            </td>
        </tr>
        <tr>
            <td style="text-align: right"><span class="required">*</span>Code:</td>
            <td>
                <input type="text" style="width: 80%" class="easyui-textbox" id="input_code" data-options="required:true,validType:'gPattern[gEnRegular]'"/>
            </td>
        </tr>
        <tr>
            <td style="text-align: right"><span class="required">*</span>Type:</td>
            <td>
                <input type="text" style="width: 80%" class="easyui-combobox" id="input_type" disabled='disabled'
                       data-options='required:true'/>
            </td>
        </tr>
        <tr>
            <td style="text-align: right"><span class="required">*</span>Sort:</td>
            <td>
                <input type="text" style="width: 80%" class="easyui-textbox" id="input_sort" data-options="required:true,validType:'gPattern[gNumRegular]'"/>
            </td>
        </tr>


    </table>
    <div class="submit_button">
        <a class="easyui-linkbutton" iconCls="icon-save" onclick="save()" style="width: 100px;"> Save</a>
        <a class="easyui-linkbutton" iconCls="icon-reload" onclick="cls()"
           style="width: 100px;margin-left: 10px;">Reset</a>
    </div>
</form>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
</body>
<script type="text/javascript">
    var dataType = localStorage.getItem("dataType")
    var typeData = {type:dataType}
    //无接口调用暂时写死
    var gData = [{type:"FundsType"},{type:"AccountType"},{type:"IdentifierType"},{type:"TransmodeType"},
        {type:"ContactType"},{type:"CommunicationType"},{type:"Currencies"},{type:"CountryCodes"},
        {type:"AccountPersonRoleType"},{type:"EntityLegalForm"},{type:"BankType"},{type:"EntityPersonRoleType"},]
    var gEnNumRegular = /^[A-Za-z0-9\-\s]+$/;
    var gEnRegular = /^[A-Z\-]+$/;
    var gNumRegular = /^[0-9\-]+$/;
    var gRequest = new RequestHandle();
    var gCurrid = getID();
    var gApiKey = "BASECODE";
    var getData;
    var gconfig = {
        valueField: 'type',
        textField: 'type',
        panelHeight: '50%',
        data:gData,
    };
    createComponentFactory("BASICDATA_NAME", '#input_type', gconfig);


    $(document).ready(function () {
        var _param = {id: gCurrid};
        var sendData = $.extend(false,_param,typeData)
        var _res;
        if (gCurrid != AddFlag) {
            _res = gRequest.putRemoteData(gApiKey, "get", sendData);
            _res.done(function (data) {
                getData = data.data;
                getFormData(data.data);
            });
        } else {
            $("#input_type").combobox("setValue",dataType)
            gCurrid = AddFlag;
        }

    });
    $.extend($.fn.validatebox.defaults.rules, {
        gPattern: {
            validator: function (value, param) {

                return param[0].test(value);
            },
            message: 'Format error, not saved!'
        }
    });

    function cls() {
        $('#ff').form('reset');
    }

    function save() {
        if(!$("#input_name").textbox('isValid')){
            $.messager.alert("Info", "Format error, not saved！");
            return
        };
        if(!$("#input_code").textbox('isValid')){
            $.messager.alert("Info", "Format error, not saved！");
            return
        };
        if(!$("#input_type").textbox('isValid')){
            $.messager.alert("Info", "Format error, not saved！");
            return
        };
        if(!$("#input_sort").textbox('isValid')){
            $.messager.alert("Info", "Format error, not saved！");
            return
        };

        var _url;
        var _method;
        if (gCurrid == AddFlag) {
            _url = "add";
            _method = "post";
        } else {
            _url = "edit";
            _method = "put";
        }
        saveData(_url);
    }

    function saveData(_url) {
        var _data = submitFormData();

        if (gCurrid == AddFlag) {
            var postData = _data;
            delete postData.id;
            postData = JSON.stringify(postData)
            gRequest.postRemoteData(gApiKey,_url,postData).done(function (result) {
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("BasicData.html");
                    parentLocation.closeDlg();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            });
        } else {
            var postData = $.extend(false, getData, _data);
            gRequest.putRemoteData(gApiKey,_url,postData).done(function (result) {
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("BasicData.html");
                    parentLocation.closeDlg();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            });
        }
    }
</script>
</html>
