<!--创建人：简佳成-->
<!--创建时间：2018.12.4-->
<!--描述：客户详情展示页面框架 未完成-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">

</head>
<body>
<div id="header" style="margin-bottom: 10px">
</div>
<div id="toolbar" style="margin-bottom: 10px"></div>
<div id="p" class="easyui-panel" title="Basic information"
     style="width:100%;height:300px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,
    collapsible:true,minimizable:false,maximizable:false">
    <form id="ff" style="width: 100%">
        <table id="basicData" class="displaytable" style="text-align:right;width: 100%;table-layout:fixed">
            <tr style="height: 60px;width: 100%">
                <td style="width: 15%;"><span class="required">*</span>标识:</td>
                <td style="width: 35%;text-align: left;">
                    <input type="text" style="width: 85%" class="easyui-combobox" data-options="required:true"
                           id="input_type"/>
                </td>
                <td style="width: 15%"><span class="required">*</span>类型:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 80%" class="easyui-textbox" id="input_number" data-options="required:true"/>
                </td>
            </tr>
            <tr>
                <td >数据上传频率:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 85%" class="easyui-datebox" id="input_issueDate"
                           data-options=''/>
                </td>
                <td>名称:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 80%" class="easyui-datebox" id="input_expiryDate" data-options=""/>
                </td>
            </tr>
            <tr>
                <td>是否可控:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 85%" class="easyui-textbox" id="input_issuedBy"
                           data-options=''/>
                </td>
                <td><span class="required">*</span>公网访问:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 80%" class="easyui-combobox" id="input_issueCountry" data-options="required:true"/>
                </td>
            </tr>
            <tr>
                <td>API地址:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 85%" class="easyui-textbox" id="input_issuedBy"
                           data-options=''/>
                </td>
                <td><span class="required">*</span>公网IP:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 80%" class="easyui-combobox" id="input_issueCountry" data-options="required:true"/>
                </td>
            </tr>
            <tr>
                <td>是否公开:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 85%" class="easyui-textbox" id="input_issuedBy"
                           data-options=''/>
                </td>
                <td><span class="required">*</span>公网IP:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 80%" class="easyui-combobox" id="input_issueCountry" data-options="required:true"/>
                </td>
            </tr>
            <tr>
                <td>简介:</td>
                <td style="text-align: left">
                    <input type="text" style="width: 225%;height: 50px" class="easyui-textbox" id="input_comments" data-options="multiline:true"/>
                </td>
            </tr>


        </table>
    </form>
</div>
<div id="r" class="easyui-panel" title="OtherInfo"
     style="width:100%;height:350px;padding:10px;background:#fafafa;overflow: hidden"
     data-options="iconCls:'icon-save',closable:false,
    collapsible:true,minimizable:false,maximizable:false">
    <form id="ff" style="width: 100%">
        <table id="sssf" class="displayable" style="text-align:right;width: 100%;table-layout:fixed">
            <tr style="height: 60px;width: 100%">
                <td style="width: 20%;">IncorporationState:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-textbox" data-options='' style="width: 80%"
                           id="input_incorporationState"/>
                </td>
                <td style="width: 15%">Country Code:</td>
                <td style="text-align: left">
                    <input type="text" class="easyui-combobox" id="input_incorporationCountryCode" style="width: 50%;"
                           data-options=""/>
                </td>
            </tr>

            <tr style="height: 60px">
                <td>Email:</td>
                <td style="width: 8%;text-align: left">
                    <input type="text" class="easyui-textbox" data-options="validType:'email'" style="width: 80%;"
                           id="input_email"/>
                </td>
                <td>Url:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-textbox" id="input_url" style="width: 50%;"
                           data-options="validType:'url'"/>
                </td>
            </tr>
            <tr style="height: 60px">
                <td>IRD Number:</td>
                <td style="width: 8%;text-align: left">
                    <input type="text" class="easyui-textbox" data-options='' style="width: 80%;"
                           id="input_irdNumber"/>
                </td>
                <td>GST Number:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-textbox" id="input_gstNumber" style="width: 50%;"
                           data-options=""/>
                </td>

            </tr>
            <tr style="height: 60px">
                <td>Comments:</td>
                <td style="width: 25%;text-align: left">
                    <input type="text" class="easyui-textbox" id="input_comments" style="width: 80%;height: 100%"
                           data-options="multiline:true"/>
                </td>


            </tr>
        </table>
    </form>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript" src="../../JS/Header.js"></script>
<script type="text/javascript">
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var gCreatHeader = new creatHeader();
    var payload = JSON.parse(localStorage.getItem("Entity"));
    var gPersonId = localStorage.getItem("personId");
    var gApiKey = "ENTITY";
    var gPostIdData = getIdArry();
    var gHeadData = ["EntityPhone", "EntityAddress"];
    var buttons = [
        {//配置toolbar
            'functionname': "Save",
            'func': 'save()',
            'icon': 'icon-save',
        }, {
            'functionname': "Delete",
            'func': 'doDelete()',
            'icon': 'icon-remove',
        }
    ];
    gBasicList.createToolbar("", buttons);
    $("#toolbar a").each(function (index, value) {
        $(value).removeAttr("plain");
    });
    gCreatHeader.creatContent("#header", gHeadData);

    var gComboboxConfig = {//配置combobox
        panelWidth: 270,
        onHidePanel: checkCombobox,

    };
    //构造combobox
    createComponentFactory("BASICDATA_COUNTRYCODES", '#input_incorporationCountryCode', gComboboxConfig);
    createComponentFactory("BASICDATA_ENTITYLEGALFORM", '#input_incorporationLegalForm', gComboboxConfig);
    var gConfig = {
        toolbar: '#toolbar',
        fitColumns: 'false',
        rownumbers: 'true',
        singleSelect: false,
        width: '100%',
        height: "150px",
        striped: 'true',
        loadMsg: 'In the process of laborious loading.....',
        showFooter: 'true',
        columns: [
            [{
                field: 'ck',
                checkbox: 'true',
            }, {
                field: 'id',
                title: 'id',
                width: '0%',
                align: 'center'
            }, {
                field: 'type',
                title: 'Type',
                width: '15%',
                align: 'center',
            }, {
                field: 'number',
                title: 'Number',
                width: '25%',
                align: 'center'
            }, {
                field: 'issueCountry',
                title: 'IssueCountry',
                width: '25%',
                align: 'center'
            },]
        ],
    };
    $("#dg").datagrid(gConfig);
    gBasicList.hideColumn(['id']);//隐藏id
    $(document).ready(function () {
        var _param = gPostIdData;
        var _res;
        if (gPostIdData.id != AddFlag) {
            _res = gRequest.putRemoteData(gApiKey, "get", _param);
            _res.done(function (data) {
                getFormData(data.data);
            });
        } else {
            gCurrid = AddFlag;
        }

    });

    function getIdArry() {
        var _idArry = {};
        var urlinfo = window.location.href;
        var len = urlinfo.length;
        var offset = urlinfo.indexOf("?");
        if (offset == -1) {
            return undefined;
        }
        var newsidinfo = urlinfo.substr(offset + 1, len);
        var newsids = newsidinfo.split("&");
        newsids.forEach(function (value, index) {
            var arr = value.split("=");
            _idArry[arr[0]] = arr[1];
        });
        return _idArry;
    }

    $.extend($.fn.validatebox.defaults.rules, {
        gPattern: {
            validator: function (value, param) {
                return param[0].test(value);
            },
            message: 'bad format!'
        }
    });

    function doDelete() {

    }

    function save() {
        var flag = checkInput();
        var _url;
        var _method;
        if (gPostIdData.id == AddFlag) {
            _url = "add";
            _method = "post";
        } else {
            _url = "edit";
            _method = "put";
        }
        if (flag) {
            saveData(_url);
        }

    }

    function saveData(_url) {
        var _data = submitFormData();
        _data.incorporationDate = new Date(_data.incorporationDate);
        _data.account = delSpace(_data.account);
        for (var i in _data) {
            if (_data[i] == "") {
                delete _data[i];
            }
        }
        if (gPostIdData.id == AddFlag) {
            var postData = $.extend(false, _data, {customerId: gPostIdData.parentId, id: 1});
            postData = JSON.stringify(postData);
            gRequest.postRemoteData(gApiKey, _url, postData).done(function (result) {
                if (result.code == 0) {
                    $.messager.alert({
                        title: 'Info',
                        msg: result.msg,
                        fn: function () {
                            gPostIdData.id = result.data;
                            var pLocation = "UI/BasicData/BasicEntityDetail.html?id=" + gPostIdData.id + "&parentId=" + gPostIdData.parentId;
                            AddTabIn("EntityDetail", parent.$('#tabs'), pLocation);
                        }
                    });
                } else {
                    $.messager.alert("Info", result.msg);
                }
            });
        } else {
            var postData = $.extend(false, _data, {customerId: gPostIdData.parentId, id: gPostIdData.id});
            gRequest.putRemoteData(gApiKey, _url, postData).done(function (result) {
                if (result.code == 0) {
                    $.messager.alert("Info", result.msg);
                } else {
                    $.messager.alert("Info", result.msg);
                }
            });
        }
    }

</script>
</html>
