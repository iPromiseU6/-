<!--创建人：吴永佳-->
<!--创建时间：2018.12.2-->
<!--描述：对ExchangeRateList的修改，新增页面-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/BasicDataPreview.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/BasicInfoCommon.css">
</head>
<body>
<div id="div_content">
    <form id="ff">
        <table id="basicData" class="displaytable" style="text-align: left;padding:20px;">
            <tr>
                <td width="25%"><span class="redTip">*</span>CustomerNumber</td>
                <td width="25%">
                    <input type="text" class="easyui-textbox" disabled data-options='required:true'
                           id="input_customerNumber"/>
                </td>
            </tr>
            <tr>
                <td width="25%">IdNumber1</td>
                <td width="25%">
                    <input type="text" class="easyui-textbox" disabled id="input_idNumber1"/>
                </td>
                <td width="25%">IdNumber2</td>
                <td width="25%">
                    <input type="text" class="easyui-textbox" disabled id="input_idNumber2"/>
                </td>
            </tr>
            <tr>
                <td width="20%">FirstName</td>
                <td width="30%">
                    <input type="text" class="easyui-textbox" disabled id="input_firstName"/>
                </td>
                <td width="20%">MiddleName</td>
                <td width="30%">
                    <input type="text" class="easyui-textbox" disabled id="input_middleName"/>
                </td>
            </tr>
            <tr>
                <td width="20%">LastName</td>
                <td width="30%">
                    <input type="text" class="easyui-textbox" disabled id="input_lastName"/>
                </td>
                <td width="20%">CurrencyCode</td>
                <td width="30%">
                    <input type="text" disabled class="easyui-textbox" id="input_currencyCode"/>
                </td>
            </tr>
            <tr>
                <td width="20%">Amount</td>
                <td width="30%">
                    <input type="text" class="easyui-textbox" id="input_amount"/>
                </td>
                <td width="20%">Type</td>
                <td width="30%">
                    <input type="text" class="easyui-combobox" data-options="editable:false" id="input_type"/>
                </td>
            </tr>
        </table>
    </form>
    <div class="submit_button" style="margin-left: 50px;">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" onclick="save()"
           style="width:100px;margin-left: -70px;">Save</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" onclick="_close()"
           style="width:100px;margin-left: 70px;">Cancel</a>
    </div>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript">
    //创建请求对象
    var gRequest = new RequestHandle();
    //拿到传过来的参数
    var gParam = getID();
    //接口
    var gApiKey = "CUSTOMERS_ACCOUNT_DETAIL";
    //全局使用的数据
    var getData;

    $(document).ready(function () {
        if (gParam) {
            //移除新增页面时的<tr>
            $("#display_tr").remove();
            //对List页面传过来的参数进行拆分组装
            var _previewId = gParam.split("_")[0];
            var _detailId = gParam.split("_")[1];
            var _param = {
                id: _detailId
            };
            //发送请求，并用getFormData同步input框内的数据
            var _res;
            _res = gRequest.putRemoteData(gApiKey, "list", _param);
            _res.done(function (data) {
                for (let o in data.data.data) {
                    if (_previewId == data.data.data[o].id) {
                        getData = data.data.data[o];
                        break
                    }
                }
                getFormData(getData);
            });
        }
    });
    var config = {
        panelWidth: 150,
        panelHeight: 67,
    };

    createComponentFactory("CUSTOMERSURPLUS_TYPE", "#input_type", config);
    createComponentFactory("CURRENCY_CODE", '#input_currencyCode', config);

    //关闭
    function _close() {
        var parentLocation;
        parentLocation = searchParent("CustomerSurplusDetail.html");
        parentLocation.dialogClose();
    }

    function save() {
        var _isValid = $("#ff").form('validate');
        if (!_isValid) {
            $.messager.alert("Warning", "Required entries not filled in");
            return;
        }
        saveData();
    }

    function saveData() {
        var _data = submitFormData();
        var _postData = $.extend(false, getData, _data);
        //由于number1给后端传值的问题，所以如果没有的话就删除
        if (_postData.idNumber1 === '' || _postData.idNumber2 === '') {
            delete _postData.idNumber1;
            delete _postData.idNumber2;
        }
        data = JSON.stringify(_postData);
        if (gParam) {
            //Updata时的操作，由于method不同和params的格式问题，所以分成两块
            gRequest.putRemoteData(gApiKey, 'edit', JSON.parse(data)).done(function (result) {
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("CustomerSurplusDetail.html");
                    parentLocation.dialogClose();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        } else {
            gRequest.postRemoteData(gApiKey, 'add', data).done(function (result) {
                if (result.code == 0) {
                    var parentLocation;
                    parentLocation = searchParent("CustomerSurplusDetail.html");
                    parentLocation.dialogClose();
                } else {
                    $.messager.alert("Info", result.msg);
                }
            })
        }
    }
</script>
</html>
