<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
</head>
<style>
</style>
<body style="padding: 0px;">
<div id="div_layout" class="easyui-layout">
    <div data-options="region:'center'">
        <div class="easyui-panel" title="DataList">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<!--必须使用这个js而不是min.js ,因为做了封装修改-->
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script>
    // $(document).ready(function () {
    //     var pLocation = "UI/Device/DeviceDetail.html?";
    //     AddTabIn("设备详情", parent.$('#tabs'), pLocation);
    // })
    ///声明部分
    var gRequest = new RequestHandle();
    var gBasicList = new BasicListPage();
    var gApiKey="DEVICE";
    var getData

    ////主流程
    var gToolBar = DATAGRID_TOOLBAR_ADD;
    gToolBar += DATAGRID_TOOLBAR_EDITOR;
    gToolBar += DATAGRID_TOOLBAR_DELETE;
    gBasicList.createToolbar(gToolBar);//创建toolbar
    ////创建表格
    var gDatagridUrl = RequestUrl.constructURL(gApiKey, "list");
    var gConfig = {
        method:"post",
        height: 580,
        columns : [
            [{
                field: 'ck',
                checkbox: true,
            },{
                field : 'user_id',
                title : 'user_id',
                width : '0%',
                align : 'center'
            }, {
                field : 'device_id',
                title : '标识',
                width : '10%',
                align : 'center'
            }, {
                field : 'device_type',
                title : '类型',
                width : '15%',
                align : 'center',
            }, {
                field : 'device_name',
                title : '名称',
                width : '15%',
                align : 'center',
            }, {
                field : 'place',
                title : '地理位置',
                width : '15%',
                align : 'center'
            },{
                field : 'is_control',
                title : '是否可控',
                width : '15%',
                align : 'center'
            },{
                field : 'is_public',
                title : '是否公开',
                width : '15%',
                align : 'center'
            }]
        ],
        onDblClickRow : function (index, row) {
            var _row = row;
            var _id = _row.device_id;
            var personId = toString(_row.personId)
            var pLocation = "UI/Device/DeviceDetail.html?id="+_id;
            AddTabIn("设备详情", parent.$('#tabs'), pLocation);
        },
    }
    gBasicList.createDataGrid(gConfig);
    gBasicList.hideColumn(['user_id']);//隐藏id
    //函数部分
    $(document).ready(function () {
        gRequest.postWithOutData(gApiKey,"list").done(function (result) {
            getData = result.data
            $('#dg').datagrid('loadData',getData);
        })
    })
    function doSearch() {
        var _searchCondition = processSearchConditionObject();
        gRequest.postRemoteData(gApiKey,"listbrif",JSON.stringify(_searchCondition)).done(function (result) {
            if(result.code===0){
                $("#dg").datagrid('loadData',result.data.data);
            }
            else{
                $.messager.alert("fail", result.msg);
            }
        })
    }

    function doReset() {
        gBasicList.resetHandle(gApiKey);
        gRequest.postRemoteData(gApiKey,"listbrif");
        $('#dg').datagrid('reload',gDatagridUrl);
    }

    function destroy(){
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you need to modify！");
            return;
        }
        var _param = {id:_row.id}
        var _sendData = JSON.stringify(_param)
        $.messager.confirm("Info", "confirm to Delete Data", function (r) {
            if (r) {
                gRequest.delRemoteData(gApiKey,"del",_sendData).done(function (result) {
                    if(result.code === 0){
                        $.messager.alert("Info",result.msg)
                        $("#dg").datagrid('reload',gDatagridUrl);
                    }else{
                        $.messager.alert("Info",result.msg)
                    }
                })
            }
        });

    }
    function editData(){
        var _row = $('#dg').datagrid('getSelected');
        if (!_row) {
            $.messager.alert('Info', "Please select the data you need to modify！");
            return;
        }
        var _id = _row.id;
        var personId = toString(_row.personId)
        localStorage.setItem("personId",_row.personId)
        var pLocation = "UI/BasicData/CustomerListDetail.html?id="+_id;
        AddTabIn("CustomerDetail", parent.$('#tabs'), pLocation);
    }
    function newData(){
        localStorage.setItem("personId",'-1')
        var aa = localStorage.getItem("personId")
        var pLocation = "UI/Device/DeviceDetail.html?id=-1";
        AddTabIn("设备详情", parent.$('#tabs'), pLocation);
    }

</script>

</html>
