<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <style>
        .required_Input {
            color: red;
        }
    </style>
</head>
<body>
<div id="div_content">
    <form id="ff">
        <table id="basicData" class="displaytable" style="text-align: left;padding:20px;">
            <tr>
                <td width="20%"><span class="required_Input">*</span>Account Name:</td>
                <td width="40%">
                    <input type="text" class="easyui-textbox" data-options='required:true' id="input_name"/>
                </td>
                <td width="20%"><span class="required_Input">*</span>In/Out:</td>
                <td width="40%">
                    <input class="easyui-combobox" data-options='required:true,editable:false' id="input_type"/>
                </td>
            </tr>
            <tr>
                <td width="20%"><span class="required_Input">*</span>Amount:</td>
                <td width="40%">
                    <input class="easyui-textbox" data-options='required:true' id="input_amount"/>
                </td>
                <td width="20%"><span class="required_Input">*</span>ChargeType:</td>
                <td width="40%">
                    <input class="easyui-combobox" data-options='required:true,editable:false' id="input_chargeTypeName"/>
                </td>
            </tr>
        </table>
        <table style="text-align: left;padding: 10px 20px 20px;width: 100%">
            <tr>
                <td width="17%" style="height: 50px;display: inline-block">memo:</td>
                <td width="83%">
                    <input class="easyui-textbox" id="input_memo" style="width: 100%;height: 50px" data-options="multiline:true"/>
                </td>
            </tr>
        </table>
    </form>
    <div class="submit_button" style="margin-left: 50px;">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-save" onclick="save()"
           style="width:100px;margin-left: -70px;"> Save</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-reload" onclick="cls()"
           style="width:100px;margin-left: 70px;">ReSet</a>
    </div>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript">
    var parentid = getID();
    var accountId = parentid.split("&")[0];
    var id = parentid.split("&")[1];
    var gApiKey = 'ACCOUNT_COMPANY';
    var gApiKeyDetail = 'ACCOUNT_DETAIL';
    var gRequest = new RequestHandle();

    $(document).ready(function () {
        if (id.indexOf("&") >= 0) {
            accountId = id.split("&")[0];
            id = id.split("&")[1];
        }
        if (id != AddFlag) {
            gRequest.putRemoteData(gApiKeyDetail, 'get', {id: id}).done(function (result) {
                result.data["type"] = getValueByKey(COMPANYACCOUNTDETAILTYPE, result.data["type"]);
                getFormData(result.data);
            });
        } else {
            gRequest.putRemoteData(gApiKey, 'get', {id: accountId}).done(function (result) {
                $("#input_name").textbox('setValue', result.data.name);
                $("#input_type").combobox('clear');
                $("#input_chargeTypeName").combobox('clear');
            });
        }
        $("#input_name").textbox('disable');
    });

    var config = {
        panelWidth: 160,
        panelHeight: 100,
    };
    createComponentFactory("DETAIL_TYPE", "#input_type", {panelWidth: 160});
    createComponentFactory("DETAIL_CHARGETYPE", '#input_chargeTypeName', config);

    function save() {
        var _data = submitFormData();
        var isValid = $('#ff').form('validate');
        if (isValid) {
            saveData(_data);
        }
    }

    function saveData(_data) {
        var _postData = _data;
        var attributeChargeType = ["chargeTypeName", "chargeTypeId"];
        var attributeType = ["text","value"];
        _postData.id = id == AddFlag ? 1 : id;
        _postData.accountId = accountId;
        //combobox getValue
        //强行转换
        _postData.type = _getValueByKey(COMPANYACCOUNTDETAILTYPE, _data.type, attributeType);
        _postData.chargeTypeId = _getValueByKey(DETAILCHARGETYPE, _data.chargeTypeName, attributeChargeType);
        delete _postData.chargeTypeName;
        var PostRequest;
        if (id == AddFlag) {
            PostRequest = gRequest.postRemoteData(gApiKeyDetail, 'add', JSON.stringify(_postData));
        } else {
            PostRequest = gRequest.putRemoteData(gApiKeyDetail, 'edit', _postData);
        }
        PostRequest.done(function (result) {
            var parentLocation;
            if (result.code == 1) {
                $.messager.alert('false', result.msg);
            } else if (result.code == 0) {
                parentLocation = searchParent("CompanyAccountDetail.html");
                parentLocation.dialogClose();
            }
        })
    }

    function cls() {
        $('#input_type').combobox('clear');
        $('#input_chargeTypeName').combobox('clear');
        $('#input_amount').textbox('clear');
        $('#input_memo').textbox('clear');


    }

    function _getValueByKey(arr, key, attribute) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i][attribute[0]] == key) {
                return arr[i][attribute[1]];
            }
        }
        return key;
    }
</script>
</html>
