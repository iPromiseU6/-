<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Themes/material/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/demo.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/common.css">
    <link rel="stylesheet" type="text/css" href="../../CSS/AccountTable.css">
</head>
<body style="padding: 0">
<div id="div_layout" class="easyui-layout">
    <div id="div_search" data-options="region:'north'">
    </div>
    <table id="Table"></table>
    <div data-options="region:'center'">
        <div class="easyui-panel" title="DataList">
            <table id="dg">
            </table>
        </div>
    </div>
</div>
<div id="toolbar"></div>
<div id="dlg" class="hiddenDialog">
    <iframe id="ifrmEdit" height="100%" width="100%" frameborder="0" scrolling="no"></iframe>
</div>
</body>
<script type="text/javascript" src="../../JS/jquery.min.js"></script>
<script type="text/javascript" src="../../JS/jquery.easyui.js"></script>
<script type="text/javascript" src="../../JS/common.js"></script>
<script type="text/javascript" src="../../Utils/ip.js"></script>
<script type="text/javascript" src="../../Utils/ShareComponent.js"></script>
<script type="text/javascript" src="../../JS/SearchComponent.js"></script>
<script type="text/javascript" src="../../Utils/BasicList.js"></script>
<script type="text/javascript" src="../../Utils/Request.js"></script>
<script type="text/javascript" src="../../JS/ToolBar.js"></script>
<script type="text/javascript" src="CreatTable.js"></script>
<script type="text/javascript" src="../../Utils/Enum.js"></script>
<script type="text/javascript">
    var gApiKey = 'ACCOUNT_COMPANY';
    var gApiKeyDetail = 'ACCOUNT_DETAIL';
    var gBasicList = new BasicListPage();
    var gRequest = new RequestHandle();
    var config = {dialogWidth: 680, dialogHeight: 350}
    var AddDialog;
    var accountId = getID();
    var url_add = "UI/CompanyAccount/CompanyAccountDetailPreview.html?accountId="+accountId+"&-1";
    var url_updata = "UI/CompanyAccount/CompanyAccountDetailPreview.html?accountId="+accountId+"&";
    ////主流程
    var gSearchOptions = SEARCH_ACCOUNT_DETAIL_CHARGETYPE;
    gSearchOptions += SEARCH_ACCOUNT_DETAIL_TYPE;
    // gSearchOptions += SEARCH_ACCOUNT_DETAIL_STARTTIME;
    // gSearchOptions += SEARCH_ACCOUNT_DETAIL_ENDTIME;
    gBasicList.createSearch(gSearchOptions);//创建搜索界面
    var gToolbar = DATAGRID_TOOLBAR_ADD;
    gToolbar += DATAGRID_TOOLBAR_EDITOR;
    gToolbar += DATAGRID_TOOLBAR_DELETE;
    gBasicList.createToolbar(gToolbar);//创建toolbar
    ////创建表格
    var gDatagridUrl = RequestUrl.constructURL(gApiKeyDetail, "list");
    var gConfig = {
        url:gDatagridUrl,
        method: 'put',
        queryParams:{accountId: accountId},
        singleSelect : true,
        columns: [
            [{
                field: 'ck',
                checkbox: true,
            }, {
                field: 'id',
                title: 'id',
                width: '0%',
                align: 'center',
            }, {
                field: 'createTime',
                title: 'CreateTime',
                width: '23%',
                align: 'center',
            }, {
                field: 'chargeTypeName',
                title: 'CommanyChargeType',
                width: '23%',
                align: 'center',
            }, {
                field: "type",
                title: 'Type',
                width: '23%',
                align: 'center',
                formatter:function (value) {
                    if(value){
                        return getValueByKey(COMPANYACCOUNTDETAILTYPE,value);
                    }
                }
            }, {
                field: "amount",
                title: 'Amount',
                width: '23%',
                align: 'center',
            },
            ]
        ],
        onDblClickRow : function (index, row) {
            gBasicList.editHandle(url_updata,config);
        },
    };
    gBasicList.createDataGrid(gConfig);
    gBasicList.hideColumn(['id']);

    //函数部分
    function doSearch() {
        var _searchCondition = processSearchConditionObject();
        _searchCondition.accountId = accountId;
        // if(_searchCondition.hasOwnProperty("createTimeStart")&&_searchCondition.hasOwnProperty("createTimeEnd")){
        //     if(_searchCondition.createTimeStart > _searchCondition.createTimeEnd){
        //         $.messager.alert("warring","Please Select true date");
        //         return;
        //     }
        //     _searchCondition.createTimeStart += " 00:00:00";
        //     _searchCondition.createTimeEnd += " 00:00:00";
        // }
        gRequest.putRemoteData(gApiKeyDetail, "list", _searchCondition).done(function (result) {
            if (result.code === 0) {
                $("#dg").datagrid('loadData', result.data.data);
            } else {
                $.messager.alert("false", result.msg);
            }
        })
    }

    function doReset() {
        gBasicList.resetHandle(gApiKey);
        $('#dg').datagrid('reload', gDatagridUrl);
    }

    function destroy() {
        var _rows = $("#dg").datagrid("getSelected");
        var _Send_ID = {};
        if (!_rows) {
            $.messager.alert('Info', 'Please select one data');
            return;
        }
        $.messager.confirm('confirm', 'Are you sure delete this record?', function (r) {
            if (r) {
                _Send_ID.id = _rows.id;
                gRequest.delRemoteData(gApiKeyDetail, 'del', JSON.stringify(_Send_ID)).done(function (result) {
                    if (result.code == 0) {
                        $("#dg").datagrid('reload', gDatagridUrl);
                    } else {
                        $.messager.alert("fail", result.msg);
                    }
                });
            }
        });
    }

    function newData() {
        gBasicList.newHandle(url_add, config);
    }

    function editData() {
        var row = $('#dg').datagrid('getSelected');
        if(!row){
            $.messager.alert('Info', 'Please select one data');
            return;
        }
        gBasicList.editHandle(url_updata,config);
    }

    function dialogClose() {
        AddDialog.dialog('close');
    }

</script>
</html>